<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Figma Translator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            background: white;
        }
        #root {
            height: 100%;
            min-height: 300px;
            padding: 16px;
        }
        .loading-state {
            padding: 20px;
            text-align: center;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
    </style>
    <script>
        // 全局错误处理
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('[Figma Translator] Global Error:', { msg, url, lineNo, columnNo, error });
            var root = document.getElementById('root');
            if (root) {
                root.innerHTML = '<div class="loading-state" style="color: red;">' +
                    '<h2>Error</h2>' +
                    '<pre>' + msg + '</pre>' +
                    '<p>Line: ' + lineNo + ', Column: ' + columnNo + '</p>' +
                    '<p>Check console for more details.</p>' +
                    '</div>';
            }
            return false;
        };

        // 未捕获的 Promise 错误处理
        window.addEventListener('unhandledrejection', function(event) {
            console.error('[Figma Translator] Unhandled Promise Rejection:', event.reason);
            var root = document.getElementById('root');
            if (root) {
                root.innerHTML = '<div class="loading-state" style="color: red;">' +
                    '<h2>Async Error</h2>' +
                    '<pre>' + (event.reason && event.reason.message || 'Unknown async error') + '</pre>' +
                    '<p>Check console for more details.</p>' +
                    '</div>';
            }
        });

        // 检查脚本加载
        window.addEventListener('error', function(event) {
            if (event.target && (event.target.nodeName === 'SCRIPT' || event.target.nodeName === 'LINK')) {
                console.error('[Figma Translator] Resource Error:', {
                    element: event.target.nodeName,
                    src: event.target.src || event.target.href,
                    error: event.error
                });
                var root = document.getElementById('root');
                if (root) {
                    root.innerHTML = '<div class="loading-state" style="color: red;">' +
                        '<h2>Resource Error</h2>' +
                        '<pre>Failed to load: ' + (event.target.src || event.target.href) + '</pre>' +
                        '<p>Check console for more details.</p>' +
                        '</div>';
                }
            }
        }, true);

        // 检查 React 和其他依赖
        window.addEventListener('load', function() {
            console.log('[Figma Translator] Window loaded, checking environment...');
            setTimeout(function() {
                try {
                    var env = {
                        React: typeof React !== 'undefined',
                        ReactDOM: typeof ReactDOM !== 'undefined',
                        document: typeof document !== 'undefined',
                        root: !!document.getElementById('root'),
                        parent: typeof parent !== 'undefined',
                        postMessage: typeof parent.postMessage === 'function'
                    };
                    console.log('[Figma Translator] Environment check:', env);

                    // 如果 React 和 ReactDOM 都加载成功，初始化应用
                    if (env.React && env.ReactDOM) {
                        console.log('[Figma Translator] Dependencies loaded, initializing app...');
                        // webpack 打包的代码会在这里执行
                    } else {
                        console.error('[Figma Translator] React or ReactDOM not loaded');
                        var root = document.getElementById('root');
                        if (root) {
                            root.innerHTML = '<div class="loading-state" style="color: red;">' +
                                '<h2>Initialization Error</h2>' +
                                '<pre>Failed to load React dependencies</pre>' +
                                '<p>Check console for more details.</p>' +
                                '</div>';
                        }
                    }
                } catch (error) {
                    console.error('[Figma Translator] Environment check failed:', error);
                }
            }, 100);
        });

        console.log('[Figma Translator] Error handlers initialized');
    </script>
</head>
<body>
    <div id="root">
        <div class="loading-state">
            <h2>Loading Figma Translator...</h2>
        </div>
    </div>
    <script>console.log('[Figma Translator] HTML template loaded');</script>
</body>
</html> 